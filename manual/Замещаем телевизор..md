Вступление:

После определенных событий, произошедших за последние несколько месяцев, начал задумаватся об замене телевиденья себе и своим близким. Очевидно самый простой вариант это покупка ТВ приставки с Андройдом на борту, однако взглянув на цены и предлагаемое железо, идея отпала. 
Активация смарт-тв не актуальна ибо в моей модели телевизора смарт-тв просто нет. Остается последний вариант, это мини-пк который будет подключен к телевизору и показывать ютуб , или видосы с семейной библиотеки.

Встала довольна сложная задачка, за скромные деньги прикупить мини-пк , однако решение нашлось быстро на б.у рынке за разумные деньги можно прикупить тонкий клиент за 50-60 евро. 
![[Pasted image 20220509152757.png]]

Получив клиент не стал церемонится и полез к нему под капот. 
![[Pasted image 20220509153307.png]]

Под капотом все стандартно, SATA для подключение штатного накопителя и еще один для подключения внешнего. Брусок алюминия на процессоре для охлаждения и ноутбучная DDR3 память.
![[Pasted image 20220509153341.png]]


Прикупив SSD на 120GB по типу Kingston A400 , и поставить его вместо штатного на 16GB.
![[Pasted image 20220509153628.png]]

получим неплохой ПК с 4GB оперативной памяти, 120GB постоянной памяти и если докупить SATA шнурок можно воткуть туда винт на 500GB. 
![[Pasted image 20220509153646.png]]
![[Pasted image 20220509153657.png]]

Подключаем клиент к монитору и запускаемся. Убедимся что не убили своими руками клиент.

На мониторе виден BIOS значит оно живое.
![[Pasted image 20220509153847.png]]

Внешний вид всего этого безобразия:
![[Pasted image 20220509153912.png]]

На этом все и начнем подготовку программной части. 
Переходим на основную машину с VirtualBox именно там мы подготовим систему для установки на клиента. 
Думаю не для кого не секрет что на подобные клиенты просится Linux,следовательно за основу был выбран популярный дистрибустив 
Debian. Выкачав оригинальный образ ставим консольную версию!
![[Pasted image 20220509154905.png]]
После ребута, накатил htop и любуемся чистенькой системкой без мусора.
![[Pasted image 20220509211834.png]]
Но так как телевизор это все таки про удобный GUI, нужно накатить какой-нибудь DE. Лично я выбрал OpenBox за его легковесность и возможности кастомизации. Впрочем не забываем про sddm , нам нужен еще и дисплейный менеджер. И ставим еще эмулятор терминала я лично выбрал kitty мне он кажется самым удобным., он нам пригодится. Устанавливается все командой: 
````sudo apt install openbox sddm kitty ````
Перезагружаемся и видим черный экран с курсором. Отлично, то что нужно , у нас на руках максимально чистая система.
![[Pasted image 20220509214612.png]]
Открываем терминал и продолжаем,нужно что-то похожее на файловый менеджер , чтобы можно было управлять файликами на нашем клиенте, выбор пал на thunar, ибо у меня был опыт его настройки.
![[Pasted image 20220509215740.png]]
Отлично, мы можем посмотреть что у нас на диске. Настало вложить главный функционал  а именно возможность смотреть youtube,читать bbc или загуглить что-то с теливизора. А это значит что нам нужен браузер, и тут выбор к сожалению один - Google Chrome. Ибо в Firefox  нет такой синхронизации, и есть мелкие косяки по типу не рабочего DRM и если будете смотреть что-то через Netflix или Amazon будет напрягать.
![[Pasted image 20220510091143.png]]
Едим дальше,  скорее всего нужно будет удаленно управлять телевизором, читаю необходимым накатить дашборд как например cockpit. 
Ставим по инструкции с офф.сайта:
``````
. /etc/os-release
echo "deb http://deb.debian.org/debian ${VERSION_CODENAME}-backports main" > \
    /etc/apt/sources.list.d/backports.list
apt update

apt install -t ${VERSION_CODENAME}-backports cockpit

``````
Открываем браузер и вводим localhost:9090
![[Pasted image 20220510141947.png]]
Вот такая картина у нас перед глазами, вводим параметры учетки и входим в админку.
Едим дальше, наверное так как у нас не 16GB, а чуть больше мы уже можем скачивать торренты и смотреть на прямо телевизоре ( не агитирую пираство, можно найти и то что раздается свободно.) в качестве торрент качалки будет использоватся qbittorent.
![[Pasted image 20220510142524.png]]
 И лезем в настройки нам неплохо бы включить веб-интерфейс. Ставим пароль на админку больше чем 6 символов
 ![[Pasted image 20220510142655.png]]
 И сразу же проверим в браузере.
 ![[Pasted image 20220510143011.png]]
 
 Отлично, торренты есть, теперь их надо как-то проигрывать, думаю отличнвм решением будет старый добрый kodi.
 ![[Pasted image 20220510143906.png]]
 Отлично, оно работает едим дальше.  Неплохо бы сюда добавить ютуб и возможность читать BBC, а заодно зашифровать весь трафик через VPN.
 Начнем с VPN: ставим через 
 ```sudo apt install openvpn```
 А далее надо поставить наднастройку надо ним которая даст нам GUI, я лично выбрал open-source  решение под названием pritunil , оно позволяет через GUI настраивать VPN подключение. Однако никто не запрещает вам подключится через SSH и настроить VPN.
 ![[Pasted image 20220510150655.png]]
 
 Для просмотра Youtube на телевизоре был выбран проект под названием Nativefier-YouTube-on-TV-for-Desktop. Он с открытым исходным кодом и выложен на GitHub. Так как проект не имеет ни репозитория ни пакета для установки, просто распакуем папку в /opt/youtube-app и напишем скрипт однострочник в /usr/bin который по команде youtube будет поднимать наш бинарник. Но думаю лучшим вариантом это создать символическую ссылку на бинарник.
 ![[Pasted image 20220510152051.png]]
 
 Дальше дело за малым, а именно создать BBC веб клиента. Так как хотелось создать самое легковесное решение этим решением стал wry. Исходный код взят из документации из wry смысла приводить его не вижу, если есть желание можете посмотреть в репозитории проекта. Скачиваем бинарник из релизов, и просто копируем его в /usr/bin. Теперь по команде bbc  в консоле он  будет открыватся.
 Однако он  потребует немного зависимостей и нам надо будет их установить.
 ```apt install libwebkit2gtk-4.0-dev libayatana-appindicator3-dev ```
 Запускаем и видим:
 ![[Pasted image 20220510213457.png]]
 И было бы неплохо настроить лаунчер для всего этого дела.
 Из последнего релиза выкачиваем .deb пакет и скачиваем его. Далее устанавливаем, и введя в терминал команду ```launcher``` наблюдаем запуск лаунчера.
 ![[Pasted image 20220510221726.png]]
 
 Осталось сделать удаленное управление. Сдесь думаю наилучшим решением будет мини-трекпад и клавитура со свистком USB.
 ![[Pasted image 20220511120944.png]]
 Oднако можно и обойтись и смартфоном с сенсорным экраном, однако для этого оба устройства должны быть в одной локальной сети. Впрочем функция полезная будующем  ну еплохо бы добавить.
 
 А теперь неплохо бы настроить себе автологин.Вводить пароль для входа в телевизор, такое себе. Так как у нас установлен тут sddm, надо создать конфиг по пути /usr/lib/sddm/sddm.conf.d/autologin с содержанием: 
 ```
 [Autologin]
User=user
Session=openbox
```
 где user это имя учетки в которую логинемся, а session это название нашего установленого DE.
 
 Осталось дело за малым! Добавить лаунчер в автозагрузку чтобы после запуска системы открывался именно он. Так как в качестве DE у нас выбран openbox лезем в .config и создаем папку openbox , куда положим файлик autostart. 
 В файл укажем полный путь до лаунчера : /usr/bin/launcher! Перезагружаемся, и видим лаунчер перед глазами! Отлично, мы почти у цели!
 ![[Pasted image 20220511142100.png]]
 Возможно вы заметили, все операции были сделаны в VirtualBox. И не случайно!
 Теперь у нас есть файлы виртальной машины. И теперь их .vdi мы сделаем .img образ припомощи которого будем заливать систему на тонкие клиенты.
 ![[Pasted image 20220511223513.png]]
 Воспользуемся штантым VBoxManage и командой :
 ```
 VBoxManage clonemedium --format RAW Debian.vdi debian.img
 ```
На выходе получаем .img файл.
![[Pasted image 20220511224813.png]]
 Теперь его нужно сжать, 55ГБ никуда не годится.
 Грузимся с livecd, и сожмем основной раздел до 10GB.
![[Pasted image 20220512084202.png]]
 Удалим штатный swap, и создаим новый.
![[Pasted image 20220512090749.png]]
И увидим кучу ошибок в консоле. Не паникуем, нам просто надо указать системе где искать swap. Лезем в консоль и коммандой ```lsblk -f``` узнаем новые UUID разделов. Дальше заходим в /etc/fstab и коректируем значения там новые которые мы только что узнали. 

Отлично повторяем швг с созданием .img образа, и видем опять 55GB. Неужели не помогло? Помогло, только надо подрезать сам образ.
![[Pasted image 20220512093357.png]]

```
sudo truncate --size=$[(22978559+1)*512] 'debian.img'
```

![[Pasted image 20220512093514.png]]
Отлично! Есть образ на 11GB, но его еще как-то надо накатить на клиента. Решил пойти по пути наимешьего сопротивления, используя две флешки! На одну накатил live-cd , а на другую образ с системой.
Загрузился, в систему подкинул флешку примонтировал используя обычным mount, а далее используя dd,залил образ на диск.



 
 
 
 
 

