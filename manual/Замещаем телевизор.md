

После определенных событий, произошедших за последние несколько месяцев, начал задумываться о замене телевидения себе и своим близким. Очевидно самый простой вариант это покупка ТВ приставки с Андройдом на борту, однако взглянув на цены и предлагаемое железо, идея отпала. 
Активация смарт-тв не актуальна ибо в моей модели телевизора смарт-тв просто нет. Остается последний вариант, это мини-пк который будет подключен к телевизору и показывать ютуб , или видосы с семейной библиотеки.

Встала довольна сложная задачка, за скромные деньги прикупить мини-пк , однако решение нашлось быстро на б.у рынке за разумные деньги можно прикупить тонкий клиент за 50-60 евро. 
![Pasted image 20220509153307](https://user-images.githubusercontent.com/20460747/168289770-501ff233-39d0-4c0f-9ecd-0921d83ff87d.png)


Получив клиент не стал церемонится и полез к нему под капот. 
![Pasted image 20220509153341](https://user-images.githubusercontent.com/20460747/168289797-f427022f-dcd1-4617-8e19-a7de668a8073.png)


Под капотом все стандартно, SATA для подключение штатного накопителя и еще один для подключения внешнего. Брусок алюминия на процессоре для охлаждения и ноутбучная DDR3 память.
![Pasted image 20220509153643](https://user-images.githubusercontent.com/20460747/168289857-5eccbd3a-4c28-499b-b0cf-09b98e9ec16f.png)



Прикупив SSD на 120GB по типу Kingston A400 , и поставить его вместо штатного на 16GB.
![Pasted image 20220509153628](https://user-images.githubusercontent.com/20460747/168289877-d6cf0972-8776-475c-9c0d-98461832a827.png)


получим неплохой ПК с 4GB оперативной памяти, 120GB постоянной памяти и если докупить SATA шнурок можно воткнуть туда винт на 500GB. 
![Pasted image 20220509153653](https://user-images.githubusercontent.com/20460747/168289992-1821fda7-b371-4db7-a07a-6d306162a5d5.png)


Подключаем клиент к монитору и запускаемся. Убедимся что не убили своими руками клиент.

На мониторе виден BIOS значит оно живое.
![Pasted image 20220509153847](https://user-images.githubusercontent.com/20460747/168290001-753714e4-725b-410f-a908-ea1f458f9eaa.png)


Внешний вид всего этого безобразия:
![Pasted image 20220509153912](https://user-images.githubusercontent.com/20460747/168290011-91fe2404-fcee-4d96-a094-31fb7f751047.png)


На этом все и начнем подготовку программной части. 
Переходим на основную машину с VirtualBox именно там мы подготовим систему для установки на клиента. 
Думаю не для кого не секрет что на подобные клиенты просится Linux,следовательно за основу был выбран популярный дистрибутив 
Debian. Выкачав оригинальный образ ставим консольную версию!
![Pasted image 20220509154905](https://user-images.githubusercontent.com/20460747/168290034-cf38ada0-bc07-45a6-b881-77e115c1b87b.png)

После ребута, накатил htop и любуемся чистенькой системой без мусора.
![Pasted image 20220509211834](https://user-images.githubusercontent.com/20460747/168290107-395a7163-3ea9-4d1f-acb7-440820b4ecde.png)


Но так как телевизор это все таки про удобный GUI, нужно накатить какой-нибудь DE. Лично я выбрал OpenBox за его легковесность и возможности кастомизации. Впрочем не забываем про sddm , нам нужен еще и дисплейный менеджер. И ставим еще эмулятор терминала я лично выбрал kitty мне он кажется самым удобным., он нам пригодится. Устанавливается все командой: 
````sudo apt install openbox sddm kitty ````
Перезагружаемся и видим черный экран с курсором. Отлично, то что нужно , у нас на руках максимально чистая система.
![Pasted image 20220509214612](https://user-images.githubusercontent.com/20460747/168290183-b4817227-18a5-44ac-81ac-6ed9fb2c089c.png)

Открываем терминал и продолжаем,нужно что-то похожее на файловый менеджер , чтобы можно было управлять файлами на нашем клиенте, выбор пал на thunar, ибо у меня был опыт его настройки.

![Pasted image 20220509215740](https://user-images.githubusercontent.com/20460747/168290241-fedd20ed-5d73-4023-854d-f5c0c36f6b5e.png)


Отлично, мы можем посмотреть что у нас на диске. Настало вложить главный функционал  а именно возможность смотреть youtube,читать bbc или загуглить что-то с телевизора. А это значит что нам нужен браузер, и тут выбор к сожалению один - Google Chrome. Ибо в Firefox  нет такой синхронизации, и есть мелкие косяки по типу не рабочего DRM и если будете смотреть что-то через Netflix или Amazon будет напрягать.
![Pasted image 20220510091143](https://user-images.githubusercontent.com/20460747/168290284-6a4d45c0-e7c7-47c3-a557-64e262e3a788.png)



Едим дальше,  скорее всего нужно будет удаленно управлять телевизором, читаю необходимым накатить дашборд как например cockpit. 
Ставим по инструкции с офф.сайта:
``````
. /etc/os-release
echo "deb http://deb.debian.org/debian ${VERSION_CODENAME}-backports main" > \
    /etc/apt/sources.list.d/backports.list
apt update

apt install -t ${VERSION_CODENAME}-backports cockpit

``````
Открываем браузер и вводим localhost:9090
![Pasted image 20220510141947](https://user-images.githubusercontent.com/20460747/168290314-7c49fbd8-8594-4237-aeb9-e1035f1707bc.png)


Вот такая картина у нас перед глазами, вводим параметры учетки и входим в админку.
Едим дальше, наверное так как у нас не 16GB, а чуть больше мы уже можем скачивать торренты и смотреть на прямо телевизоре ( не агитирую пираство, можно найти и то что раздается свободно.) в качестве торрент качалки будет использоваться qbittorrent.
![Pasted image 20220510142524](https://user-images.githubusercontent.com/20460747/168290353-1f070618-f0f4-4876-a5cb-c99908b89e35.png)



 И лезем в настройки нам неплохо бы включить веб-интерфейс. Ставим пароль на админку больше чем 6 символов
![Pasted image 20220510142655](https://user-images.githubusercontent.com/20460747/168290378-195b8926-e4f9-4ef2-a5a8-9578ffb94eb0.png)


 И сразу же проверим в браузере.
![Pasted image 20220510143011](https://user-images.githubusercontent.com/20460747/168290425-247ff0c8-7e0f-4273-a336-85a7cf748795.png)

 
 Отлично, торренты есть, теперь их надо как-то проигрывать, думаю отличным решением будет старый добрый kodi.

 Отлично, оно работает едим дальше.  Неплохо бы сюда добавить ютуб и возможность читать BBC, а заодно зашифровать весь трафик через VPN.
 Начнем с VPN: ставим через 
 ```sudo apt install openvpn```
 А далее надо поставить на настройку надо ним которая даст нам GUI, я лично выбрал open-source  решение под названием pritunil , оно позволяет через GUI настраивать VPN подключение. Однако никто не запрещает вам подключится через SSH и настроить VPN.
![Pasted image 20220510150655](https://user-images.githubusercontent.com/20460747/168290495-c103aeba-b6c0-4e34-8f86-e4d3b9c0d45e.png)

 
 Для просмотра Youtube на телевизоре был выбран проект под названием Nativefier-YouTube-on-TV-for-Desktop. Он с открытым исходным кодом и выложен на GitHub. Так как проект не имеет ни репозитория ни пакета для установки, просто распакуем папку в /opt/youtube-app и напишем скрипт однострочник в /usr/bin который по команде youtube будет поднимать наш бинарник. Но думаю лучшим вариантом это создать символическую ссылку на бинарник.

 
 Дальше дело за малым, а именно создать BBC веб клиента. Так как хотелось создать самое легковесное решение этим решением стал wry. Исходный код взят из документации из wry смысла приводить его не вижу, если есть желание можете посмотреть в репозитории проекта. Скачиваем бинарник из релизов, и просто копируем его в /usr/bin. Теперь по команде bbc  в консоле он  будет открыватся.
 Однако он  потребует немного зависимостей и нам надо будет их установить.
 ```apt install libwebkit2gtk-4.0-dev libayatana-appindicator3-dev ```
 Запускаем и видим:
![Pasted image 20220510213457](https://user-images.githubusercontent.com/20460747/168290552-e8ab0d23-9ec2-4a14-854e-b4923a66fce3.png)



 И было бы неплохо настроить лаунчер для всего этого дела.
 Из последнего релиза выкачиваем .deb пакет и скачиваем его. Далее устанавливаем, и введя в терминал команду ```launcher``` наблюдаем запуск лаунчера.
![Pasted image 20220510221726](https://user-images.githubusercontent.com/20460747/168290582-c5435b86-373b-4182-b3c6-6ef7318c1c58.png)

 
 Осталось сделать удаленное управление. Здесь думаю наилучшим решением будет мини-трекпад и клавиатура со свистком USB.
 ![Pasted image 20220511120944](https://user-images.githubusercontent.com/20460747/168290618-1b1f11f6-36e4-446f-9615-70ca287d1d68.png)

 
 
 Однако можно и обойтись и смартфоном с сенсорным экраном, однако для этого оба устройства должны быть в одной локальной сети. Впрочем функция полезная будущем  ну неплохо бы добавить.
 
 А теперь неплохо бы настроить себе автологин.Вводить пароль для входа в телевизор, такое себе. Так как у нас установлен тут sddm, надо создать конфиг по пути /usr/lib/sddm/sddm.conf.d/autologin с содержанием: 
 ```
 [Autologin]
User=user
Session=openbox
```
 где user это имя учетки в которую логинимся, а session это название нашего установленного DE.
 
 Осталось дело за малым! Добавить лаунчер в автозагрузку чтобы после запуска системы открывался именно он. Так как в качестве DE у нас выбран openbox лезем в .config и создаем папку openbox , куда положим файлик autostart. 
 В файл укажем полный путь до лаунчера : /usr/bin/launcher! Перезагружаемся, и видим лаунчер перед глазами! Отлично, мы почти у цели!
 Возможно вы заметили, все операции были сделаны в VirtualBox. И не случайно!
 Теперь у нас есть файлы виртуальной машины. И теперь их .vdi мы сделаем .img образ при помощи которого будем заливать систему на тонкие клиенты.
 Воспользуемся штатным VBoxManage и командой :
 ```
 VBoxManage clonemedium --format RAW Debian.vdi debian.img
 ```
На выходе получаем .img файл.


 Теперь его нужно сжать, 55 ГБ никуда не годится.
 ![Pasted image 20220511224813](https://user-images.githubusercontent.com/20460747/168291008-a77d4b8b-2c5c-4d77-9d9d-55ffa96d2848.png)
 Грузимся с livecd, и сожмем основной раздел до 10GB.
 ![Pasted image 20220512090623](https://user-images.githubusercontent.com/20460747/168291285-ea019795-d1e1-4967-b272-9131e7b8e420.png)
 Удалим штатный swap, и создаем новый.

И увидим кучу ошибок в консоле. Не паникуем, нам просто надо указать системе где искать swap. Лезем в консоль и командой ```lsblk -f``` узнаем новые UUID разделов. Дальше заходим в /etc/fstab и корректируем значения там новые которые мы только что узнали. 

![Pasted image 20220512090749](https://user-images.githubusercontent.com/20460747/168291513-1ec9e4c7-79b3-48b7-ab68-61247e25e940.png)



Отлично повторяем швг с созданием .img образа, и видим опять 55 GB. Неужели не помогло? Помогло, только надо подрезать сам образ.

```
sudo truncate --size=$[(22978559+1)*512] 'debian.img'
```![Pasted image 20220512093514](https://user-images.githubusercontent.com/20460747/168291563-6358b3f8-68e8-4006-93c5-36486188b8a8.png)



Отлично! Есть образ на 11GB, но его еще как-то надо накатить на клиента. Решил пойти по пути наименьшего сопротивления, используя две флешки! На одну накатил live-cd , а на другую образ с системой.
Загружается, в систему подкинул флешку примонтировал используя обычным mount, а далее используя dd,залил образ на диск.



 
 
 
 
 


